events {}
http {
  upstream orchestrator {
    server orchestrator:3001;
  }

  upstream crm-int {
    server crm-int:3003;
  }

  server {
    listen 80;

    location /wf/ {
      proxy_pass http://orchestrator/;
      rewrite ^/wf(/.*)$ $1 break; # Remove '/wf' prefix
    }

    location /crm/ {
      proxy_pass http://crm-int/;
      rewrite ^/crm(/.*)$ $1 break; # Remove '/crm' prefix
    }

    # Add timeouts to handle service startup delays
    proxy_connect_timeout 10s;
    proxy_read_timeout 30s;
    proxy_send_timeout 30s;
  }
}
